<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>С 1 Мая! | Мир • Труд • Май</title>
    <style>
        /* Базовые стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, 
                        Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            transition: background 0.6s ease;
            position: relative;
            overflow: hidden;
        }
        
        body.peace {
            background: linear-gradient(135deg, #e0f7fa 0%, #80deea 100%);
        }
        
        body.labor {
            background: linear-gradient(135deg, #fff8e1 0%, #ffcc80 100%);
        }
        
        body.may {
            background: linear-gradient(135deg, #f1f8e9 0%, #aed581 100%);
        }
        
        body.all-on {
            background: linear-gradient(135deg, #f9fbe7 0%, #dce775 50%, #ffb74d 100%);
        }
        
        /* Карточка */
        .card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.18);
            padding: 2rem;
            max-width: 420px;
            width: 100%;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            z-index: 10;
        }
        
        /* Заголовок */
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 0.5rem;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
        }
        
        .subtitle {
            text-align: center;
            color: #555;
            font-weight: 500;
            font-size: clamp(1.1rem, 3vw, 1.4rem);
            margin-bottom: 1rem;
        }
        
        /* Переключатели */
        .toggles {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }
        
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .toggle-label {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 500;
            color: #333;
        }
        
        /* iOS-style переключатель */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            min-width: 60px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #4CAF50;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        input:not(:checked) + .slider {
            background-color: #f44336;
        }
        
        /* Статус текст */
        #status {
            text-align: center;
            font-size: 1.1rem;
            color: #555;
            min-height: 2.5rem;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            line-height: 1.4;
        }
        
        /* Кнопка поделиться */
        #share {
            display: block;
            margin: 0.5rem auto;
            padding: 0.7rem 1.5rem;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            color: white;
            border: none;
            border-radius: 2rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-height: 44px;
        }
        
        #share:hover, #share:focus {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            outline: none;
        }
        
        #share:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Анимации и эффекты */
        @keyframes fly {
            0% {
                transform: translate(0, 0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) rotate(var(--rot));
                opacity: 0;
            }
        }
        
        @keyframes hammer {
            0% {
                transform: translateY(-100px) rotate(-45deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100px) rotate(45deg);
                opacity: 0;
            }
        }
        
        @keyframes blossom {
            0% {
                transform: translateY(30px);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            80% {
                opacity: 1;
                transform: translateY(-30px);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px);
            }
        }
        
        @keyframes fall {
            0% {
                transform: translateY(-30px) rotate(0deg);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            100% {
                transform: translateY(300px) rotate(var(--rot));
                opacity: 0;
            }
        }
        
        @keyframes flash {
            0%, 50%, 100% {
                opacity: 1;
            }
            25%, 75% {
                opacity: 0.5;
            }
        }
        
        .emoji {
            position: absolute;
            font-size: 24px;
            z-index: 1;
            pointer-events: none;
            user-select: none;
        }
        
        /* Canvas для конфетти */
        #confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        
        /* Доступность */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Фокус для доступности */
        input:focus-visible + .slider {
            outline: 2px solid #4285f4;
            outline-offset: 2px;
        }
        
        /* Адаптив */
        @media (min-width: 480px) {
            .card {
                padding: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <canvas id="confetti"></canvas>
    
    <main class="card">
        <div>
            <h1>С 1 Мая!</h1>
            <p class="subtitle">Мир • Труд • Май</p>
        </div>
        
        <section class="toggles">
            <div class="toggle-row">
                <span class="toggle-label">Мир</span>
                <label class="switch" for="peace-toggle">
                    <input type="checkbox" id="peace-toggle" class="peace-toggle" aria-label="Включить Мир">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="toggle-row">
                <span class="toggle-label">Труд</span>
                <label class="switch" for="labor-toggle">
                    <input type="checkbox" id="labor-toggle" class="labor-toggle" aria-label="Включить Труд">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="toggle-row">
                <span class="toggle-label">Май</span>
                <label class="switch" for="may-toggle">
                    <input type="checkbox" id="may-toggle" class="may-toggle" aria-label="Включить Май">
                    <span class="slider"></span>
                </label>
            </div>
        </section>
        
        <p id="status">Включай переключатели и празднуй!</p>
        
        <button id="share">Поделиться</button>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
        // Состояние
        const state = {
            peace: false,
            labor: false,
            may: false
        };
        
        // Фразы для различных состояний
        const phrases = {
            "000": "Ничего себе! День сурка?",
            "100": "Мир есть, а дела-то стоят...",
            "010": "Трудимся без мира? Сурово.",
            "001": "На май переключились — уже тепло!",
            "110": "Мирный труд — основа успеха!",
            "101": "Мир + Май = Весна без забот!",
            "011": "Труд в мае вдвойне приятнее!",
            "111": "Настоящий Первомай! 🎉"
        };
        
        // Пул юмористических фраз
        const humorPhrases = [
            "Без мира труду май-он не быть!",
            "Выключил труд? Счас профсоюз узнает!",
            "Май без цветения — как шашлык без мангала.",
            "Мир, труд, май... и шашлык в придачу!",
            "Отключил май? В Сибирь, наверное, переехал!",
            "Мир, труд, май — звучит как инструкция к жизни.",
            "Труд и май - дружба навек!",
            "Мир перевернулся? Включи переключатель обратно!",
            "Кто не включил май, тот... точно не из профсоюза!",
            "Труд без мира, как макароны без сыра — можно, но зачем?"
        ];
        
        // Получение случайной фразы из массива
        function getRandomPhrase(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }
        
        // Обработчики переключателей
        document.getElementById('peace-toggle').addEventListener('change', function() {
            state.peace = this.checked;
            if (this.checked) {
                releaseEmojis(['☮️', '🕊️', '🤝', '🫂', '🌍'], 5);
                document.body.classList.add('peace');
            } else {
                document.body.classList.remove('peace');
                darkenBg();
            }
            updateStatus();
        });
        
        document.getElementById('labor-toggle').addEventListener('change', function() {
            state.labor = this.checked;
            if (this.checked) {
                throwHammer();
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                document.body.classList.add('labor');
            } else {
                flashRelax();
                document.body.classList.remove('labor');
            }
            updateStatus();
        });
        
        document.getElementById('may-toggle').addEventListener('change', function() {
            state.may = this.checked;
            if (this.checked) {
                blossom();
                document.body.classList.add('may');
            } else {
                fallLeaves();
                document.body.classList.remove('may');
            }
            updateStatus();
        });
        
        // Обновление статуса и визуальных эффектов
        function updateStatus() {
            const stateKey = `${state.peace ? '1' : '0'}${state.labor ? '1' : '0'}${state.may ? '1' : '0'}`;
            const statusElement = document.getElementById('status');
            
            // Обновление текста статуса
            statusElement.textContent = phrases[stateKey];
            
            // Проверка на все включенные переключатели
            if (stateKey === '111') {
                fireworksConfetti();
                document.body.classList.add('all-on');
            } else {
                document.body.classList.remove('all-on');
            }
            
            // Иногда добавляем случайную юмористическую фразу (больше шансов при изменениях)
            const lastChanged = document.querySelector('input:checked');
            
            if (lastChanged && Math.random() < 0.4) {
                setTimeout(() => {
                    statusElement.textContent = getRandomPhrase(humorPhrases);
                    // Возвращаем обычный статус через некоторое время
                    setTimeout(() => {
                        const currentStateKey = `${state.peace ? '1' : '0'}${state.labor ? '1' : '0'}${state.may ? '1' : '0'}`;
                        statusElement.textContent = phrases[currentStateKey];
                    }, 3000);
                }, 800);
            }
        }
        
        // Функции визуальных эффектов
        function releaseEmojis(emojis, count) {
            for (let i = 0; i < count; i++) {
                const emoji = document.createElement('div');
                emoji.classList.add('emoji');
                emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                emoji.style.setProperty('--tx', `${-100 + Math.random() * 200}px`);
                emoji.style.setProperty('--ty', `${-150 - Math.random() * 100}px`);
                emoji.style.setProperty('--rot', `${-45 + Math.random() * 90}deg`);
                emoji.style.left = `${20 + Math.random() * 60}%`;
                emoji.style.top = '70%';
                emoji.style.animation = 'fly 2s forwards';
                
                document.body.appendChild(emoji);
                
                // Удаляем элемент после анимации
                setTimeout(() => {
                    document.body.removeChild(emoji);
                }, 2000);
            }
        }
        
        function throwHammer() {
            const hammer = document.createElement('div');
            hammer.classList.add('emoji');
            hammer.textContent = '🔨';
            hammer.style.fontSize = '36px';
            hammer.style.left = '50%';
            hammer.style.top = '50%';
            hammer.style.animation = 'hammer 1s forwards';
            
            document.body.appendChild(hammer);
            
            // Добавляем текст "Вперёд, к труду!"
            const text = document.createElement('div');
            text.textContent = 'Вперёд, к труду!';
            text.style.position = 'absolute';
            text.style.left = '50%';
            text.style.top = '60%';
            text.style.transform = 'translateX(-50%)';
            text.style.color = '#d32f2f';
            text.style.fontWeight = 'bold';
            text.style.zIndex = '5';
            text.style.padding = '10px';
            text.style.background = 'rgba(255, 255, 255, 0.7)';
            text.style.borderRadius = '8px';
            text.style.animation = 'flash 1s';
            
            document.body.appendChild(text);
            
            // Удаляем элементы после анимации
            setTimeout(() => {
                document.body.removeChild(hammer);
                document.body.removeChild(text);
            }, 1500);
        }
        
        function flashRelax() {
            const relaxPhrases = [
                'Отдых — тоже труд!',
                'Труд отменяется! Сиеста!',
                'Перерыв на шашлыки!'
            ];
            
            const text = document.createElement('div');
            text.textContent = getRandomPhrase(relaxPhrases);
            text.style.position = 'absolute';
            text.style.left = '50%';
            text.style.top = '50%';
            text.style.transform = 'translate(-50%, -50%)';
            text.style.color = '#ff9800';
            text.style.fontWeight = 'bold';
            text.style.fontSize = '1.5rem';
            text.style.zIndex = '5';
            text.style.padding = '15px';
            text.style.background = 'rgba(255, 255, 255, 0.8)';
            text.style.borderRadius = '12px';
            text.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.2)';
            text.style.animation = 'flash 1.5s';
            
            document.body.appendChild(text);
            
            // Удаляем элемент после анимации
            setTimeout(() => {
                document.body.removeChild(text);
            }, 1500);
        }
        
        function blossom() {
            const flowers = ['🌸', '🌷', '🌹', '🌺', '🌻', '🌼'];
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const flower = document.createElement('div');
                    flower.classList.add('emoji');
                    flower.textContent = flowers[Math.floor(Math.random() * flowers.length)];
                    flower.style.fontSize = `${16 + Math.random() * 12}px`;
                    flower.style.left = `${Math.random() * 100}%`;
                    flower.style.top = '80%';
                    flower.style.animation = 'blossom 3s forwards';
                    flower.style.animationDelay = `${Math.random() * 0.5}s`;
                    
                    document.body.appendChild(flower);
                    
                    // Удаляем элемент после анимации
                    setTimeout(() => {
                        document.body.removeChild(flower);
                    }, 3500);
                }, i * 200);
            }
        }
        
        function fallLeaves() {
            const leaves = ['🍂', '🍁', '🍃'];
            
            for (let i = 0; i < 10; i++) {
                const leaf = document.createElement('div');
                leaf.classList.add('emoji');
                leaf.textContent = leaves[Math.floor(Math.random() * leaves.length)];
                leaf.style.setProperty('--rot', `${-180 + Math.random() * 360}deg`);
                leaf.style.fontSize = `${16 + Math.random() * 12}px`;
                leaf.style.left = `${Math.random() * 100}%`;
                leaf.style.top = '10%';
                leaf.style.animation = 'fall 3s forwards';
                leaf.style.animationDelay = `${Math.random() * 0.5}s`;
                
                document.body.appendChild(leaf);
                
                // Удаляем элемент после анимации
                setTimeout(() => {
                    document.body.removeChild(leaf);
                }, 3500);
            }
        }
        
        function darkenBg() {
            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.width = '100%';
            overlay.style.height = '100%';
            overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.2)';
            overlay.style.zIndex = '1';
            overlay.style.pointerEvents = 'none';
            overlay.style.transition = 'opacity 0.5s';
            
            document.body.appendChild(overlay);
            
            // Удаляем затемнение после анимации
            setTimeout(() => {
                overlay.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(overlay);
                }, 500);
            }, 500);
        }
        
        // Конфетти при включении всех переключателей
        function fireworksConfetti() {
            const myConfetti = confetti.create(document.getElementById('confetti'), {
                resize: true,
                useWorker: true
            });
            
            myConfetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
            
            // Через полсекунды запускаем еще одно конфетти с другими параметрами
            setTimeout(() => {
                myConfetti({
                    particleCount: 50,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0, y: 0.6 }
                });
                
                myConfetti({
                    particleCount: 50,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1, y: 0.6 }
                });
            }, 500);
        }
        
        // Кнопка поделиться
        document.getElementById('share').addEventListener('click', function() {
            const shareData = {
                title: 'С 1 Мая! Мир • Труд • Май',
                text: 'Интерактивное поздравление с 1 мая!',
                url: window.location.href + (window.location.href.includes('?') ? '&' : '?') + 'may=1'
            };
            
            if (navigator.share) {
                navigator.share(shareData)
                    .catch((error) => {
                        console.warn('Ошибка при попытке поделиться:', error);
                        copyToClipboard(shareData.url);
                    });
            } else {
                copyToClipboard(shareData.url);
            }
        });
        
        // Функция копирования в буфер обмена
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        alert('Ссылка скопирована в буфер обмена!');
                    })
                    .catch((error) => {
                        console.error('Не удалось скопировать текст: ', error);
                        fallbackCopyToClipboard(text);
                    });
            } else {
                fallbackCopyToClipboard(text);
            }
        }
        
        // Запасной вариант копирования в буфер обмена
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '0';
            textArea.style.top = '0';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                const msg = successful ? 'успешно' : 'неудачно';
                console.log('Fallback: копирование текста ' + msg);
                alert('Ссылка скопирована в буфер обмена!');
            } catch (err) {
                console.error('Fallback: невозможно скопировать', err);
                alert('Не удалось скопировать ссылку: ' + err);
            }
            
            document.body.removeChild(textArea);
        }

        // Проверка параметра URL для возможного трекинга
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('may')) {
            console.log('Пользователь пришел по шаринг-ссылке');
        }
        
        // Добавляем возможность перетаскивания для desktop
        const sliders = document.querySelectorAll('.slider');
        sliders.forEach(slider => {
            let isDragging = false;
            
            slider.addEventListener('mousedown', (e) => {
                isDragging = true;
                document.addEventListener('mousemove', handleDrag);
                document.addEventListener('mouseup', stopDrag);
            });
            
            function handleDrag(e) {
                if (!isDragging) return;
                
                const rect = slider.getBoundingClientRect();
                const toggleInput = slider.parentElement.querySelector('input');
                const sliderWidth = rect.width;
                const clickX = e.clientX - rect.left;
                
                // Устанавливаем состояние переключателя в зависимости от позиции мыши
                if (clickX > sliderWidth / 2) {
                    toggleInput.checked = true;
                } else {
                    toggleInput.checked = false;
                }
                
                // Вызываем событие change для обработки изменения
                const event = new Event('change');
                toggleInput.dispatchEvent(event);
            }
            
            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', handleDrag);
                document.removeEventListener('mouseup', stopDrag);
            }
        });
        
        // Инициализация начального состояния
        updateStatus();
    </script>
</body>
</html>